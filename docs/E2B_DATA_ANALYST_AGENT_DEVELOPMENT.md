# E2B Data Analyst Agent å¼€å‘æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ç›®æ ‡
åœ¨LibreChaté¡¹ç›®ä¸­å¼€å‘åŸºäºE2Bæ²™ç®±çš„æ•°æ®åˆ†æAgentæ¨¡å—ï¼Œä¸Azure Assistants**å¹¶è¡Œ**è¿è¡Œï¼Œç”¨äºå¤„ç†Azure Assistantsæ— æ³•è§£å†³çš„åœºæ™¯ï¼ˆå¦‚é•¿æ—¶é—´è¿è¡Œçš„ä»£ç æ‰§è¡Œã€XGBoostç­‰å¯†é›†å‹å·¥ä½œè´Ÿè½½ï¼‰ã€‚

### 1.2 æ¶æ„å®šä½
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LibreChat Frontend                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Layer (Express.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Azure Assistants â”‚  â”‚  E2B Assistants  â”‚              â”‚
â”‚  â”‚  (ç°æœ‰)          â”‚  â”‚  (æ–°å¢)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                        â”‚                       â”‚
â”‚         â–¼                        â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Azure OpenAI API â”‚  â”‚  E2B + LLM API   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦è¯´æ˜**ï¼š
- **ä¸åˆ é™¤**ç°æœ‰çš„Azure Assistantsæ¨¡å—
- ä¸¤è€…å¹¶è¡Œè¿è¡Œï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©
- E2B Agentä¸“é—¨ç”¨äºéœ€è¦é•¿æ—¶é—´ä»£ç æ‰§è¡Œã€å¤æ‚è®¡ç®—çš„åœºæ™¯
- è®¿é—®æ§åˆ¶ï¼ˆç§æœ‰/å…¬å…±Assistantï¼‰ç”±åä½œäººå‘˜å®ç°

---

## 2. èŒè´£åˆ†å·¥

| æ¨¡å— | è´Ÿè´£äºº | è¯´æ˜ |
|------|--------|------|
| E2Bå®¢æˆ·ç«¯é›†æˆ | **å½“å‰å¼€å‘** | E2B SDKé›†æˆã€æ²™ç®±ç®¡ç† |
| Code ExecutionæœåŠ¡ | **å½“å‰å¼€å‘** | ä»£ç æ‰§è¡Œã€ç»“æœæ•è· |
| Data Analyst Agent | **å½“å‰å¼€å‘** | Agentæ ¸å¿ƒé€»è¾‘ã€LLMé›†æˆ |
| æ–‡ä»¶å¤„ç† | **å½“å‰å¼€å‘** | æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®é›†åŠ è½½ |
| è®¿é—®æ§åˆ¶ | **åä½œäººå‘˜** | ç§æœ‰/å…¬å…±Assistantæƒé™ç®¡ç† |
| å‰ç«¯UI | **åä½œäººå‘˜** | E2B Assistantç•Œé¢å±•ç¤º |
| é…ç½®ç®¡ç† | **åä½œäººå‘˜** | ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ |

---

## 3. æŠ€æœ¯æ ˆ

### 3.1 æ ¸å¿ƒä¾èµ–
- **E2B Code Interpreter SDK**: `@e2b/code-interpreter` (v2.8.4+)
- **OpenAI API**: `openai` (v4.x) - ç”¨äº LLM æ¨ç†ï¼ˆGPT-4, GPT-4o ç­‰æ¨¡å‹ï¼‰
- **MongoDB**: å­˜å‚¨ Assistant é…ç½®ã€å¯¹è¯å†å²ã€æ–‡ä»¶å…ƒæ•°æ®
- **Node.js/Express.js**: åç«¯æ¡†æ¶ï¼ˆv18+ï¼‰

### 3.2 LLM è¯´æ˜
æœ¬é¡¹ç›®ä½¿ç”¨ **OpenAI API** è¿›è¡Œæ¨ç†ï¼Œæ”¯æŒçš„æ¨¡å‹åŒ…æ‹¬ï¼š
- GPT-4 / GPT-4-turbo
- GPT-4o / GPT-4o-mini
- **Azure OpenAI** (æ¨èé…ç½®)
  - æ”¯æŒ Azure OpenAI Service éƒ¨ç½²
  - æ”¯æŒ gpt-5-mini ç­‰æœ€æ–°é¢„è§ˆæ¨¡å‹
  - è‡ªåŠ¨å¤„ç† Azure ç‰¹å®šçš„ API ç‰ˆæœ¬å’Œç«¯ç‚¹æ ¼å¼
- æˆ–ä»»ä½•å…¼å®¹ OpenAI API çš„æ¨¡å‹ï¼ˆå¦‚é€šè¿‡ä»£ç†è®¿é—®çš„å…¶ä»–æ¨¡å‹ï¼‰

#### Azure OpenAI é›†æˆ (2026-01-15)
é¡¹ç›®å·²å®Œå…¨æ”¯æŒ Azure OpenAI APIï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š

**ç¯å¢ƒå˜é‡é…ç½®**:
```env
# ä¿æŒé»˜è®¤å€¼è§¦å‘ Azure ä¼˜å…ˆçº§
OPENAI_API_KEY=user_provided

# Azure OpenAI é…ç½®
AZURE_OPENAI_ENDPOINT=https://your-resource.cognitiveservices.azure.com/
AZURE_OPENAI_API_KEY=your_azure_api_key
AZURE_OPENAI_API_VERSION=2025-01-01-preview
AZURE_OPENAI_DEPLOYMENT=gpt-5-mini
```

**åˆå§‹åŒ–é€»è¾‘** (`initialize.js`):
- æ£€æµ‹åˆ° `OPENAI_API_KEY=user_provided` æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ Azure é…ç½®
- åˆ›å»º Azure OpenAI å®¢æˆ·ç«¯æ—¶ä½¿ç”¨éƒ¨ç½²ç‰¹å®šçš„ baseURLï¼š
  ```javascript
  baseURL: `${azureEndpoint}/openai/deployments/${azureDeployment}`
  ```
- åœ¨å®¢æˆ·ç«¯å¯¹è±¡ä¸Šé™„åŠ  `azureDeployment` å±æ€§ä¾› Agent ä½¿ç”¨

**Azure ç‰¹æ€§å¤„ç†**:
1. **æ¨¡å‹åç§°**: E2B Agent ä¼˜å…ˆä½¿ç”¨ `openai.azureDeployment` è€Œé `assistant.model`
2. **Temperature é™åˆ¶**: Azure OpenAI çš„ gpt-5-mini ä¸æ”¯æŒ temperature=0ï¼Œä»…æ”¯æŒé»˜è®¤å€¼ (1)
   - Agent è‡ªåŠ¨æ£€æµ‹ Azure å¹¶è·³è¿‡ temperature å‚æ•°
3. **API ç‰ˆæœ¬**: ä½¿ç”¨ `2025-01-01-preview` æ”¯æŒæœ€æ–°æ¨¡å‹ç‰¹æ€§

---

## 4. ç›®å½•ç»“æ„è§„åˆ’

```
LibreChat/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ E2BAssistant.js              # [å·²å®ç°] E2B Assistantæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ Agents/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ e2bAgent/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ index.js           # [å·²å®ç°] 446è¡Œ - ReActå¾ªç¯Agentæ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ contextManager.js  # [å·²å®ç°] 387è¡Œ - ä¸Šä¸‹æ–‡ç®¡ç†å™¨ 
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ prompts.js         # [å·²å®ç°] 154è¡Œ - ç³»ç»Ÿæç¤ºè¯
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ tools.js           # [å·²å®ç°] 266è¡Œ - å·¥å…·å®šä¹‰ä¸æ‰§è¡Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ Endpoints/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ e2bAssistants/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ index.js           # [å·²å®ç°] ç«¯ç‚¹å…¥å£
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ initialize.js      # [å·²å®ç°] 748è¡Œ - E2Bæ²™ç®±ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ buildOptions.js    # [å·²å®ç°] é€‰é¡¹æ„å»º
â”‚   â”‚   â”‚   â”œâ”€â”€ Sandbox/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ codeExecutor.js        # [å·²å®ç°] 163è¡Œ - Pythonä»£ç æ‰§è¡Œ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ fileHandler.js         # [å·²å®ç°] 172è¡Œ - æ–‡ä»¶åŒæ­¥ä¸æŒä¹…åŒ–
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â””â”€â”€ e2bAssistants/
â”‚   â”‚           â”œâ”€â”€ index.js               # [å·²å®ç°] è·¯ç”±æ³¨å†Œ
â”‚   â”‚           â””â”€â”€ controller.js          # [å·²å®ç°] 619è¡Œ - HTTP/SSEæ§åˆ¶å™¨
â”‚   â””â”€â”€ tests/
â”‚       â””â”€â”€ e2b/
â”‚           â”œâ”€â”€ codeExecutor.test.js       # [å·²å®ç°] CodeExecutorå•å…ƒæµ‹è¯•
â”‚           â”œâ”€â”€ fileHandler.test.js        # [å·²å®ç°] FileHandlerå•å…ƒæµ‹è¯•
â”‚           â”œâ”€â”€ real_integration.js        # [å·²å®ç°] çœŸå®ç¯å¢ƒç«¯åˆ°ç«¯æµ‹è¯•
â”‚           â””â”€â”€ debug_sandbox.js           # [å·²å®ç°] æ²™ç®±è°ƒè¯•è„šæœ¬
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ data-schemas/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ schema/
â”‚       â”‚   â”‚   â””â”€â”€ e2bAssistant.ts        # [å·²å®ç°] E2B Assistant Schema
â”‚       â”‚   â”œâ”€â”€ models/
â”‚       â”‚   â”‚   â””â”€â”€ e2bAssistant.ts        # [å·²å®ç°] E2B Assistant Model
â”‚       â”‚   â””â”€â”€ types/
â”‚       â”‚       â””â”€â”€ e2bAssistant.ts        # [å·²å®ç°] TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ E2B_AGENT_ARCHITECTURE.md          # [å·²å®ç°] ç³»ç»Ÿæ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ E2B_AGENT_FIXES.md                 # [å·²å®ç°] é—®é¢˜è§£å†³æ–‡æ¡£
â”‚   â”œâ”€â”€ E2B_DATA_ANALYST_AGENT_DEVELOPMENT.md # [æœ¬æ–‡æ¡£] å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ E2B_AGENT_TEST_CASES.md            # [å·²å®ç°] æµ‹è¯•ç”¨ä¾‹
```

---

## 5. æ ¸å¿ƒæ¨¡å—å®ç°è¯¦æƒ…

### 5.1 Context Manager (`contextManager.js`) 
- **åŠŸèƒ½**: ä¸Šä¸‹æ–‡ç®¡ç†çš„ Single Source of Truth
- **ä»£ç **: 387 è¡Œ
- **èŒè´£**:
  - **å†…éƒ¨/å¤–éƒ¨IDåˆ†ç¦»**: å­˜å‚¨å¸¦UUIDçš„ file_idï¼Œå¯¹å¤–åªæš´éœ²å¹²å‡€æ–‡ä»¶å
  - **ä¸Šä¸‹æ–‡ç”Ÿæˆ**: ä¸º LLM ç”Ÿæˆç»“æ„åŒ–ä¸Šä¸‹æ–‡ï¼ˆæ–‡ä»¶åˆ—è¡¨ã€å¯¹è¯å†å²ã€å·¥ä»¶ä¿¡æ¯ï¼‰
  - **é”™è¯¯æ¢å¤**: æä¾›åˆ†å±‚é”™è¯¯å»ºè®®ï¼ˆå…³é”®é”™è¯¯ + é€šç”¨è°ƒè¯•ï¼‰
  - **conversationIdè¿½è¸ª**: é˜²æ­¢è·¨å¯¹è¯æ··æ·†
- **å…³é”®æ–¹æ³•**:
  - `getContextForIteration()`: ç”Ÿæˆå½“å‰è¿­ä»£çš„å®Œæ•´ä¸Šä¸‹æ–‡
  - `updateFileContext()`: æ›´æ–°æ–‡ä»¶æ˜ å°„
  - `generateErrorGuidance()`: ç”Ÿæˆé”™è¯¯æ¢å¤å»ºè®®

### 5.2 E2BDataAnalystAgent (`index.js`)
- **åŠŸèƒ½**: åŸºäº ReAct å¾ªç¯çš„æ™ºèƒ½ä»£ç†æ ¸å¿ƒ
- **ä»£ç **: 446 è¡Œ
- **LLM**: ä½¿ç”¨ **OpenAI API**ï¼ˆGPT-4/GPT-4oï¼‰
- **ç‰¹æ€§**:
  - **ReActå¾ªç¯**: Thought â†’ Action â†’ Observation â†’ æœ€å¤š20æ¬¡è¿­ä»£
  - **æ²™ç®±å¤ç”¨**: åŒä¸€å¯¹è¯ä½¿ç”¨ç›¸åŒæ²™ç®±å®ä¾‹
  - **åŒå±‚æ¢å¤**: Layer 1 (åˆå§‹åŒ–) + Layer 2 (æ‰§è¡Œæ—¶)
  - **è‡ªæ„ˆèƒ½åŠ›**: é”™è¯¯è‡ªåŠ¨åé¦ˆç»™ LLMï¼Œé€šè¿‡é€šç”¨è°ƒè¯•ç­–ç•¥è‡ªä¸»ä¿®å¤
  - **å·¥å…·è°ƒç”¨**: `execute_code`, `upload_file`ï¼ˆå·²ç§»é™¤å†—ä½™çš„ download_fileï¼‰
  - **æµå¼è¾“å‡º**: æ”¯æŒ SSE é€ token è¿”å›

### 5.3 E2B Sandbox Manager (`initialize.js`)
- **åŠŸèƒ½**: ç®¡ç† E2B æ²™ç®±ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºã€é”€æ¯ã€é‡ç”¨ï¼‰
- **ä»£ç **: 748 è¡Œ
- **SDKé€‚é…**: é€‚é…äº† `@e2b/code-interpreter` v2.8.4
- **å…³é”®ç‰¹æ€§**:
  - ä½¿ç”¨ `Sandbox.create()` å’Œ `sandbox.kill()`
  - æ–‡ä»¶æ“ä½œï¼š`.files.write()`, `.files.read()` ä¸å¼‚æ­¥æµå¤„ç†
  - é…ç½®ï¼šé»˜è®¤ `secure: false` ä»¥å¢å¼ºå…¼å®¹æ€§
  - æ™ºèƒ½æ¨¡æ¿é€‰æ‹©ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿æˆ–é»˜è®¤æ¨¡æ¿
  - **åŒå±‚æ–‡ä»¶æ¢å¤**:
    * Layer 1: processMessage æ£€æµ‹æ²™ç®±è¿‡æœŸå¹¶æ¢å¤æ–‡ä»¶
    * Layer 2: tools.js æ‰§è¡Œè¶…æ—¶æ£€æµ‹å¹¶é‡å»ºæ²™ç®±

### 5.4 Tools (`tools.js`)
- **åŠŸèƒ½**: å·¥å…·å®šä¹‰ä¸æ‰§è¡Œé€»è¾‘
- **ä»£ç **: 266 è¡Œ
- **å·¥å…·åˆ—è¡¨**:
  - `execute_code`: æ‰§è¡Œ Python ä»£ç ï¼Œè‡ªåŠ¨æ•è·å›¾è¡¨
  - `upload_file`: ä¸Šä¼ æ–‡ä»¶åˆ°æ²™ç®±
- **å…³é”®æ”¹è¿›**:
  - **ç»Ÿä¸€è§‚å¯Ÿæ ¼å¼**: æˆåŠŸ/å¤±è´¥éƒ½è¿”å›å®Œæ•´ç»“æ„ï¼ˆæ¶ˆé™¤æ— é™å¾ªç¯ï¼‰
  - **Layer 2 æ¢å¤**: æ•è·æ²™ç®±è¶…æ—¶å¹¶è‡ªåŠ¨é‡å»º
  - **è·¯å¾„ç®€åŒ–**: ç›´æ¥åœ¨ observation ä¸­æä¾›æ­£ç¡®çš„ Web è·¯å¾„

### 5.5 CodeExecutor (`codeExecutor.js`)
- **åŠŸèƒ½**: åœ¨æ²™ç®±ä¸­æ‰§è¡Œ Python ä»£ç ï¼Œå¤„ç† `stdout`/`stderr`ï¼Œå¹¶æå–ç”Ÿæˆçš„å›¾è¡¨
- **ä»£ç **: 163 è¡Œ
- **ç‰¹æ€§**: 
  - **å›¾è¡¨æå–**: è‡ªåŠ¨ä» execution results ä¸­æå– PNG/JPEG/SVG æ ¼å¼çš„å›¾ç‰‡
  - **å®‰å…¨æ ¡éªŒ**: åŸºç¡€ä»£ç å®‰å…¨æ£€æŸ¥ï¼Œæ‹¦æˆªå±é™©å‡½æ•°ï¼ˆå¦‚ `os.system`ï¼‰
  - **æ‰¹é‡æ‰§è¡Œ**: æ”¯æŒæŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªä»£ç å—
  - **é”™è¯¯æ•è·**: å®Œæ•´çš„ traceback ä¼ é€’

### 5.6 FileHandler (`fileHandler.js`)
- **åŠŸèƒ½**: å¤„ç† LibreChat ç³»ç»Ÿå­˜å‚¨ä¸ E2B æ²™ç®±ä¹‹é—´çš„æ–‡ä»¶åŒæ­¥
- **ä»£ç **: 172 è¡Œ
- **ç‰¹æ€§**:
  - **å¤šå­˜å‚¨æ”¯æŒ**: å…¼å®¹ Local, S3, Azure Blob Storage
  - **Artifacts æŒä¹…åŒ–**: å°†æ²™ç®±ç”Ÿæˆçš„å›¾ç‰‡/CSV ä¸‹è½½å¹¶ä¿å­˜åˆ°ç³»ç»Ÿå­˜å‚¨
  - **å†…å­˜æŒä¹…åŒ–**: æ”¯æŒç›´æ¥å°† Buffer ä¿å­˜ï¼Œæ— éœ€é‡å¤ä¸‹è½½
  - **UUIDå‰¥ç¦»**: ä¸Šä¼ åˆ°æ²™ç®±æ—¶ç§»é™¤æ–‡ä»¶åä¸­çš„ UUID å‰ç¼€
  - **æ²™ç®±æ–‡ä»¶æ¢å¤**: ä»æ•°æ®åº“é‡æ–°ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°æ–°æ²™ç®±

### 5.7 Controller (`controller.js`)
- **åŠŸèƒ½**: HTTP/SSE è¯·æ±‚å¤„ç†
- **ä»£ç **: 619 è¡Œ
- **ç‰¹æ€§**:
  - **SSE æµå¼**: åˆ›å»º SSE è¿æ¥ï¼Œé€ token è¿”å›
  - **æ¶ˆæ¯æŒä¹…åŒ–**: ä¿å­˜ç”¨æˆ·æ¶ˆæ¯å’Œ Agent å“åº”åˆ° MongoDB
  - **å†å²åŠ è½½**: å¤šè½®å¯¹è¯æ—¶åŠ è½½å†å²æ¶ˆæ¯
  - **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

### 5.8 System Prompt ä¼˜åŒ– (2026-01-15)

**èƒŒæ™¯**: gpt-5-mini æ˜¯è½»é‡çº§é¢„è§ˆæ¨¡å‹ï¼Œåœ¨æ•°æ®åˆ†æåœºæ™¯ä¸­å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- é‡å¤æ€§è¾“å‡ºï¼ˆé‡å¤æ‰§è¡Œç›¸åŒåˆ†æï¼‰
- ç»“æ„åŒ–ä¸è¶³ï¼ˆç¼ºå°‘æ¸…æ™°çš„æ®µè½å’Œç« èŠ‚ï¼‰
- ç¼ºä¹ç³»ç»Ÿæ€§æ€è€ƒï¼ˆæœªæŒ‰é€»è¾‘é¡ºåºæ¨è¿›ï¼‰

**ä¼˜åŒ–ç­–ç•¥** (`prompts.js`):

#### 1. æ˜ç¡®å·¥ä½œæµç¨‹
```
## ğŸ”„ Execution Workflow
1ï¸âƒ£ **Plan** (First turn only)
   - List 5-10 analysis steps

2ï¸âƒ£ **Execute** (Iterative loop):
   - **State Step**: Briefly describe current step
   - **Action**: Call `execute_code` directly
     - ğŸ›‘ **DO NOT** write Python code in markdown block before calling tool
     - âœ… **DO** call tool immediately with code in arguments
   - **Observation**: Review result, note success/error
   - **Progress**: Check if complete or continue
```

#### 2. å…³é”®çº¦æŸ
- **ç¦æ­¢ Markdown ä»£ç å—**: å¼ºè°ƒç›´æ¥è°ƒç”¨å·¥å…·ï¼Œä¸è¦å…ˆå†™ ```python å—
- **å¼ºåˆ¶å›¾åƒæ˜¾ç¤º**: å¿…é¡»ä½¿ç”¨ `![Description](path_from_result)` æ˜¾ç¤ºå›¾ç‰‡
- **é”™è¯¯è‡ªæ„ˆ**: é‡åˆ°é”™è¯¯æ—¶åˆ†æ tracebackï¼Œä¿®å¤åé‡è¯•ï¼Œæ— éœ€è¯¢é—®ç”¨æˆ·

#### 3. ç¯å¢ƒè¯´æ˜
- åˆ—å‡ºå¯ç”¨çš„ Python åº“ï¼ˆpandas, numpy, matplotlib, seaborn, scikit-learn ç­‰ï¼‰
- è¯´æ˜æ–‡ä»¶è·¯å¾„è§„åˆ™ï¼ˆä½¿ç”¨å®Œæ•´è·¯å¾„ï¼Œä¸æ·»åŠ  UUID å‰ç¼€ï¼‰
- å¯è§†åŒ–æç¤ºï¼ˆä½¿ç”¨ `plt.show()`ï¼Œå›¾åƒè‡ªåŠ¨æ•è·ï¼‰

**æ•ˆæœ**:
- è¾“å‡ºæ›´ç»“æ„åŒ–ï¼ˆæ¸…æ™°çš„æ­¥éª¤åˆ’åˆ†ï¼‰
- å‡å°‘é‡å¤æ‰§è¡Œï¼ˆæŒ‰è®¡åˆ’é€æ­¥æ¨è¿›ï¼‰
- å›¾åƒæ˜¾ç¤ºæ›´å¯é ï¼ˆå¼ºåˆ¶ Markdown è¯­æ³•ï¼‰
- é”™è¯¯æ¢å¤æ›´è‡ªä¸»ï¼ˆåˆ†æé”™è¯¯å¹¶è‡ªåŠ¨ä¿®å¤ï¼‰

---

## 6. ç³»ç»Ÿé›†æˆç‚¹

### 6.1 ç«¯ç‚¹æ³¨å†Œ
- **Enum**: åœ¨ `packages/data-provider/src/schemas.ts` æ·»åŠ äº† `EModelEndpoint.e2bAssistants`ã€‚
- **Index**: åœ¨ `api/server/services/Endpoints/index.js` æ³¨å†Œäº†åˆå§‹åŒ–å…¥å£ã€‚
- **Config**: åœ¨ `api/server/services/Config/EndpointService.js` æ·»åŠ äº†é…ç½®ç”Ÿæˆé€»è¾‘ã€‚

### 6.2 åŠ©æ‰‹é€»è¾‘é›†æˆ
- **Helpers**: åœ¨ `api/server/controllers/assistants/helpers.js` ä¸­æ·»åŠ äº†å¯¹ `e2bAssistants` çš„æ”¯æŒï¼š
  - `getOpenAIClient`: è·¯ç”±åˆ° E2B çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¹¶ç¡®ä¿åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯è¿›è¡Œ Agent æ¨ç†ã€‚
  - `fetchAssistants`: ä» `E2BAssistant` æ¨¡å‹è·å–åŠ©æ‰‹åˆ—è¡¨ã€‚

---

## 7. è‡ªå®šä¹‰æ¨¡æ¿ä¸é¢„è£…åŒ… (é‡è¦ ğŸ’¡)

### 7.1 æ¨¡æ¿ç³»ç»Ÿ (V2)
æœ¬é¡¹ç›®é‡‡ç”¨ E2B æœ€æ–°çš„ **TypeScript æ¨¡æ¿ç³»ç»Ÿ**ã€‚æ¨¡æ¿å®šä¹‰ä½äº `e2b_template/data-analyst/template.ts`ã€‚è¿™ç§æ–¹å¼æ¯”æ—§çš„ Dockerfile æ›´çµæ´»ï¼Œæ”¯æŒç¼–ç¨‹å¼å®šä¹‰ç¯å¢ƒã€‚

### 7.2 æ„å»ºä¸å‘å¸ƒæ­¥éª¤
å¦‚æœéœ€è¦æ·»åŠ æ–°çš„ Python åŒ…ï¼ˆå¦‚ `lightgbm`ï¼‰æˆ–ç³»ç»Ÿä¾èµ–ï¼š

1.  **ä¿®æ”¹æ¨¡æ¿å®šä¹‰**:
    ç¼–è¾‘ `e2b_template/data-analyst/template.ts`:
    ```typescript
    // ç¤ºä¾‹ï¼šæ·»åŠ æ–°çš„ Python åŒ…
    .run("pip install lightgbm")
    ```

2.  **æ„å»ºæ¨¡æ¿**:
    ```bash
    cd e2b_template/data-analyst
    npm install
    # æ„å»ºå¼€å‘ç‰ˆ (Dev)
    npm run e2b:build:dev
    # æˆ–æ„å»ºç”Ÿäº§ç‰ˆ (Prod)
    # npm run e2b:build:prod
    ```

3.  **è·å– Template ID**:
    æ„å»ºæˆåŠŸåï¼Œæ§åˆ¶å°ä¼šè¾“å‡º Template ID (å¦‚ `xed696qfsyzpaei3ulh5`)ã€‚

4.  **é…ç½®ä½¿ç”¨**:
    å°†æ–°çš„ Template ID æ›´æ–°åˆ° `.env` æ–‡ä»¶ä¸­ï¼š
    ```bash
    E2B_SANDBOX_TEMPLATE=xed696qfsyzpaei3ulh5
    ```

---

## 8. æ•…éšœæ’é™¤ (Troubleshooting)

### 8.1 502: The sandbox is running but port is not open
*   **åŸå› **ï¼šæ²™ç®±å†…çš„ä»£ç è§£é‡Šå™¨è¿›ç¨‹æœªå¯åŠ¨ã€‚
*   **è§£å†³æ–¹æ³•**ï¼š
    1.  **æ£€æŸ¥ Template ID**ï¼šç¡®ä¿ `.env` ä¸­çš„ ID å¯¹åº”çš„æ˜¯åŸºäº `code-interpreter` æ„å»ºçš„æ¨¡æ¿ã€‚
    2.  **é‡æ–°æ„å»º**ï¼šå¦‚æœæ¨¡æ¿æŸåï¼Œé‡æ–°è¿è¡Œæ„å»ºå‘½ä»¤ç”Ÿæˆæ–° IDã€‚

### 8.2 400: Template is not compatible with secured access
*   **åŸå› **ï¼šE2B API Key å¼€å¯äº†â€œå®‰å…¨è®¿é—®â€é™åˆ¶ã€‚
*   **è§£å†³æ–¹æ³•**ï¼šæˆ‘ä»¬åœ¨ä»£ç ä¸­å·²é»˜è®¤è®¾ç½® `secure: false`ã€‚å¦‚æœé—®é¢˜ä¾æ—§ï¼Œè¯·æ£€æŸ¥ E2B Dashboard çš„ API Key è®¾ç½®ã€‚

---

## 9. å‰ç«¯é›†æˆçŠ¶æ€ä¸å·²çŸ¥é—®é¢˜ (2026-01-04)

### 9.1 å·²å®Œæˆçš„é›†æˆ âœ…
- **å›¾æ ‡æ”¯æŒ**: E2B Assistants ç°åœ¨ä½¿ç”¨ Sparkles (âœ¨) å›¾æ ‡ã€‚
- **åŠ©æ‰‹åˆ›å»º**: ä¿®å¤äº† JSON è§£æé”™è¯¯ï¼ŒåŠ©æ‰‹å¯ä»¥æˆåŠŸåˆ›å»ºå¹¶ä¿å­˜åˆ°æ•°æ®åº“ã€‚
- **åç«¯è·¯ç”±**: è¡¥å…¨äº† `/documents` å’Œ `/tools` ç«¯ç‚¹ï¼Œæ¶ˆé™¤äº†å‰ç«¯ 404 é”™è¯¯ã€‚
- **åŠ©æ‰‹åˆ—è¡¨**: ä¿®å¤ API å“åº”æ ¼å¼ï¼Œåˆ·æ–°åå¯æ­£ç¡®æ˜¾ç¤ºå·²åˆ›å»ºçš„åŠ©æ‰‹ã€‚
- **æ–‡ä»¶ä¸Šä¼ **: å®Œæ•´å®ç°æ–‡ä»¶ä¸Šä¼ åˆ° E2B æ²™ç®±åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆLocal/S3/Azureï¼‰ã€‚
- **æ¶ˆæ¯æµ**: SSE æ¶ˆæ¯æ ¼å¼å®Œå…¨å¯¹é½å‰ç«¯é¢„æœŸï¼Œå®ç° created å’Œ final äº‹ä»¶ã€‚
- **æ•°æ®æŒä¹…åŒ–**: ç”¨æˆ·æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“ã€‚

### 9.2 ä¿®å¤çš„å…³é”® Bug âœ…

#### âœ… 1. æ–‡ä»¶ä¸Šä¼ å¤±è´¥ (å·²ä¿®å¤)
- **é—®é¢˜**: `Cannot read properties of undefined (reading 'paths')`
- **åŸå› **: E2B è·¯ç”±ç¼ºå°‘ `configMiddleware`ï¼Œå¯¼è‡´ `req.config` æœªåˆå§‹åŒ–
- **ä¿®å¤**: åœ¨è·¯ç”±ä¸­æ·»åŠ  `configMiddleware`ï¼Œç¡®ä¿é…ç½®æ­£ç¡®åŠ è½½

#### âœ… 2. å‰ç«¯æ— è¾“å‡º (å·²ä¿®å¤)
- **é—®é¢˜**: æ¶ˆæ¯å‘é€åå‰ç«¯æ— å“åº”ï¼Œæ˜¾ç¤º "2/2" ä½†æ— å†…å®¹
- **åŸå› **: SSE æ¶ˆæ¯æ ¼å¼ä¸ç¬¦åˆå‰ç«¯é¢„æœŸï¼Œç¼ºå°‘å¿…éœ€å­—æ®µ
- **ä¿®å¤**: 
  - å®ç°å®Œæ•´çš„ SSE äº‹ä»¶æµï¼ˆcreated â†’ finalï¼‰
  - æ·»åŠ  conversation, requestMessage, responseMessage
  - ä½¿ç”¨ `sanitizeMessageForTransmit` æ¸…ç†æ¶ˆæ¯

#### âœ… 3. åŠ©æ‰‹åˆ—è¡¨ä¸æ˜¾ç¤º (å·²ä¿®å¤)
- **é—®é¢˜**: åˆ·æ–°é¡µé¢åçœ‹ä¸åˆ°å·²åˆ›å»ºçš„åŠ©æ‰‹
- **åŸå› **: API è¿”å›æ•°ç»„è€Œé `{ data: [...] }` æ ¼å¼
- **ä¿®å¤**: ç»Ÿä¸€ API å“åº”æ ¼å¼ï¼Œä¸ Azure Assistants ä¿æŒä¸€è‡´

#### âœ… 4. åŠ©æ‰‹é…ç½®ä¿å­˜é—®é¢˜ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: åˆ›å»ºåŠ©æ‰‹ååˆ·æ–°é¡µé¢ï¼Œéƒ¨åˆ†é…ç½®å­—æ®µé‡ç½®ï¼ˆdescriptionã€instructionsã€conversation_startersã€append_current_datetimeã€toolsç­‰ï¼‰
- **åŸå› **: 
  - Schemaç¼ºå°‘ `append_current_datetime`ã€`tools`ã€`tool_resources` å­—æ®µå®šä¹‰
  - Controllerçš„ get/list/update æ–¹æ³•æœªæ˜ å°„æ‰€æœ‰å­—æ®µ
  - `instructions` â†” `prompt` å­—æ®µæ˜ å°„ä¸å®Œæ•´
- **ä¿®å¤**:
  - åœ¨ `e2bAssistantSchema` ä¸­æ·»åŠ ç¼ºå¤±å­—æ®µï¼ˆappend_current_datetimeã€toolsã€tool_resourcesï¼‰
  - åœ¨ `createAssistant` ä¸­ä¿å­˜æ‰€æœ‰å‰ç«¯å‘é€çš„å­—æ®µ
  - åœ¨ `getAssistant`/`listAssistants` ä¸­è¿”å›å®Œæ•´å­—æ®µæ˜ å°„å¹¶è®¾ç½®é»˜è®¤å€¼
  - åœ¨ `updateAssistant` ä¸­ä½¿ç”¨ç™½åå•æ–¹å¼å¤„ç†æ‰€æœ‰å¯æ›´æ–°å­—æ®µ

#### âœ… 5. å¯¹è¯å†å²ä¸¢å¤±é—®é¢˜ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: åŒä¸€å¯¹è¯ä¸­çš„ç¬¬äºŒæ¡æ¶ˆæ¯ä¸è®°å¾—ç¬¬ä¸€æ¡è¯´äº†ä»€ä¹ˆ
- **åŸå› **: `chat` ç«¯ç‚¹è°ƒç”¨ `agent.processMessage(text)` æ—¶æœªä¼ é€’å†å²æ¶ˆæ¯
- **ä¿®å¤**:
  - åœ¨ `controller.js` ä¸­æ·»åŠ  `getMessages` å¯¼å…¥
  - åœ¨è°ƒç”¨ `processMessage` å‰ä½¿ç”¨ `getMessages` åŠ è½½å¯¹è¯å†å²
  - å°†å†å²æ¶ˆæ¯è½¬æ¢ä¸º OpenAI æ ¼å¼ï¼ˆrole: user/assistantï¼‰å¹¶ä¼ é€’ç»™ Agent

#### âœ… 6. å›¾åƒè·¯å¾„æ›¿æ¢å¤±è´¥ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: LLMç”Ÿæˆçš„sandbox:è·¯å¾„æ— æ³•åœ¨å‰ç«¯æ˜¾ç¤ºå›¾åƒ
- **åŸå› **: 
  - `image_url_map` ä¸­çš„è·¯å¾„æ¨¡å¼ä¸å¤Ÿå…¨é¢
  - ä»…ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼Œæ— æ³•å¤„ç†LLMç”Ÿæˆçš„å„ç§è·¯å¾„æ ¼å¼
- **ä¿®å¤**:
  - åœ¨ `tools.js` ä¸­æ·»åŠ æ›´å¤šsandboxè·¯å¾„æ¨¡å¼ï¼ˆsandbox:/ã€sandbox://ã€/tmp/ç­‰ï¼‰
  - åœ¨ `index.js` ä¸­æ·»åŠ ä¸¤å±‚æ›¿æ¢ç­–ç•¥ï¼š
    1. ç²¾ç¡®åŒ¹é… `image_url_map` ä¸­çš„æ‰€æœ‰æ¨¡å¼
    2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä»»ä½•åŒ…å«å›¾åƒæ–‡ä»¶åçš„sandbox:æˆ–æ–‡ä»¶è·¯å¾„
  - å­˜å‚¨ `image_names` å’Œ `image_actual_paths` ç”¨äºæ¨¡å¼åŒ¹é…

### 9.3 å½“å‰åŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åŠ©æ‰‹åˆ›å»º | âœ… å®Œæˆ | æ”¯æŒé€šè¿‡ Builder åˆ›å»ºåŠ©æ‰‹ |
| åŠ©æ‰‹é…ç½®ä¿å­˜ | âœ… å®Œæˆ | æ‰€æœ‰é…ç½®å­—æ®µæ­£ç¡®æŒä¹…åŒ– |
| åŠ©æ‰‹åˆ—è¡¨ | âœ… å®Œæˆ | åˆ·æ–°åæ­£ç¡®æ˜¾ç¤º |
| æ–‡ä»¶ä¸Šä¼  | âœ… å®Œæˆ | æ”¯æŒ Local/S3/Azure å­˜å‚¨ |
| ä»£ç æ‰§è¡Œ | âœ… å®Œæˆ | E2B æ²™ç®±æ‰§è¡Œ Python ä»£ç  |
| å›¾åƒç”Ÿæˆ | âœ… å®Œæˆ | è‡ªåŠ¨æå–å¹¶æ˜¾ç¤ºmatplotlib/seabornå›¾è¡¨ |
| æ¶ˆæ¯æ˜¾ç¤º | âœ… å®Œæˆ | SSE æµå¼è¿”å›æ¶ˆæ¯ |
| æ•°æ®æŒä¹…åŒ– | âœ… å®Œæˆ | æ¶ˆæ¯ä¿å­˜åˆ° MongoDB |
| å†å²å¯¹è¯ | âœ… å®Œæˆ | å¤šè½®å¯¹è¯ä¿æŒä¸Šä¸‹æ–‡ |
| æ²™ç®±å¤ç”¨ | âœ… å®Œæˆ | åŒä¸€å¯¹è¯å¤ç”¨æ²™ç®±å®ä¾‹ |

### 9.4 å¾…ä¼˜åŒ–åŠŸèƒ½

- **æµå¼å“åº”**: å½“å‰å·²å®ç°åŸºç¡€æµå¼ï¼ˆé€ token è¾“å‡ºï¼‰ï¼Œå¯è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½
- **é”™è¯¯é‡è¯•**: å¢å¼º LLM å·¥å…·è°ƒç”¨å¤±è´¥çš„é‡è¯•æœºåˆ¶
- **Token ä¼˜åŒ–**: å‡å°‘ç³»ç»Ÿæç¤ºè¯å’Œå·¥å…·å®šä¹‰çš„ Token æ¶ˆè€—
- **è®¿é—®æ§åˆ¶**: å®ç°ç§æœ‰/å…¬å…±åŠ©æ‰‹æƒé™ç®¡ç†ï¼ˆå¾…åä½œäººå‘˜å®Œæˆï¼‰
- **æ¨¡å‹åˆ‡æ¢**: æ”¯æŒå‰ç«¯åŠ¨æ€é€‰æ‹© OpenAI / Azure OpenAI / å…¶ä»–å…¼å®¹ API
- **Prompt å¾®è°ƒ**: é’ˆå¯¹ä¸åŒæ¨¡å‹ï¼ˆGPT-4o, gpt-5-miniï¼‰ä¼˜åŒ– system prompt

---

## 10. æœ€æ–°æ›´æ–° (2026-01-15)

### E2B Assistant æ–‡ä»¶æŒä¹…åŒ–åŠŸèƒ½
- âœ… å®ç°ä¾§è¾¹æ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆç±»ä¼¼ Azure Assistantsï¼‰
- âœ… æ–‡ä»¶å…³è”åˆ° assistant.tool_resources.code_interpreter.file_ids
- âœ… E2B Agent ä»ä¸‰ä¸ªæ¥æºè¯»å–æ–‡ä»¶ï¼ˆæ¶ˆæ¯é™„ä»¶ + tool_resources + root file_idsï¼‰
- âœ… æ–‡ä»¶è·¨ä¼šè¯æŒä¹…åŒ–ï¼ˆé‡æ–°ç™»å½•åä»ç„¶å¯ç”¨ï¼‰
- âœ… æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆLocal/S3/Azure/Firebaseï¼‰
- âœ… æ–‡ä»¶å…ƒæ•°æ®æ£€ç´¢ APIï¼ˆpopulateCodeFilesï¼‰
- âœ… å®‰å…¨éš”ç¦»ï¼šæ‰€æœ‰ä¿®æ”¹ä»…å½±å“ E2Bï¼Œä¸å½±å“å…¶ä»– LibreChat åŠŸèƒ½

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `api/server/routes/e2bAssistants/controller.js`: æ·»åŠ  populateCodeFiles å‡½æ•°
- `api/server/routes/files/files.js`: E2B æ£€æµ‹å’Œè·¯ç”±ä¿®æ­£
- `api/server/services/Agents/e2bAgent/index.js`: ä¸‰æºæ–‡ä»¶æ”¶é›†å’Œå»é‡
- `api/server/services/Files/process.js`: E2B ç‰¹å®šçš„æ–‡ä»¶å…³è”é€»è¾‘å’Œ fallback
- `client/src/hooks/Files/useFileHandling.ts`: ç§»é™¤é”™è¯¯çš„ endpoint è¦†ç›–

**æ–‡ä»¶ä¸Šä¼ æµç¨‹**:
1. **ä¾§è¾¹æ ä¸Šä¼ **ï¼ˆæŒä¹…åŒ–ï¼‰ï¼šæ–‡ä»¶å…³è”åˆ° assistantï¼Œä¿å­˜åˆ° tool_resources
2. **èŠå¤©é™„ä»¶**ï¼ˆä¸´æ—¶ï¼‰ï¼šæ–‡ä»¶ä»…ç”¨äºå½“å‰æ¶ˆæ¯ï¼Œä¸ä¿å­˜åˆ° assistant

è¯¦ç»†æµç¨‹è¯·å‚é˜… [æ–‡ä»¶æµé€»è¾‘.md](./help_docs/æ–‡ä»¶æµé€»è¾‘.md)

### Azure OpenAI é›†æˆ
- âœ… æ”¯æŒ Azure OpenAI Serviceï¼ˆä¼˜å…ˆäºæ ‡å‡† OpenAI APIï¼‰
- âœ… ä½¿ç”¨éƒ¨ç½²ç‰¹å®šçš„ baseURL æ ¼å¼
- âœ… è‡ªåŠ¨å¤„ç† Azure çš„ temperature é™åˆ¶
- âœ… æ¨¡å‹åç§°ä¼˜å…ˆä½¿ç”¨ Azure deployment åç§°

### System Prompt ä¼˜åŒ–
- âœ… é’ˆå¯¹ gpt-5-mini ä¼˜åŒ–å·¥ä½œæµç¨‹
- âœ… å¼ºè°ƒç»“æ„åŒ–è¾“å‡ºï¼ˆPlan â†’ Execute è¿­ä»£å¾ªç¯ï¼‰
- âœ… ç¦æ­¢ Markdown ä»£ç å—ï¼Œç›´æ¥è°ƒç”¨å·¥å…·
- âœ… å¼ºåˆ¶ä½¿ç”¨ Markdown è¯­æ³•æ˜¾ç¤ºå›¾åƒ
- âœ… æ”¹è¿›é”™è¯¯è‡ªæ„ˆèƒ½åŠ›

### ä»£ç è´¨é‡
- âœ… æ¸…ç†æ‰€æœ‰ä¸´æ—¶è°ƒè¯•æ—¥å¿—
- âœ… Temperature å¤„ç†é€»è¾‘ç®€åŒ–
- âœ… Azure æ£€æµ‹æœºåˆ¶ç¨³å®š
- âœ… ä»£ç å®‰å…¨å®¡æŸ¥å®Œæˆï¼ˆç¡®è®¤ä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼‰

---

## 11. ç‰ˆæœ¬å†å²ä¸ä¿®å¤è®°å½•

### æœ€æ–°æ›´æ–° (2026-01-21)

#### â±ï¸ æ‰§è¡Œæ—¶é—´æ˜¾ç¤ºåŠŸèƒ½
- âœ… åœ¨ E2B ä»£ç æ‰§è¡Œæ—¶æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´
- âœ… åç«¯æ•è· startTime å’Œ elapsedTime å¹¶é€šè¿‡ SSE å‘é€
- âœ… å‰ç«¯å®æ—¶æ˜¾ç¤ºè®¡æ—¶å™¨ï¼ˆæ‰§è¡Œä¸­æ¯ 100ms æ›´æ–°ï¼‰
- âœ… å®Œæˆåæ˜¾ç¤ºæ€»æ‰§è¡Œæ—¶é—´ï¼ˆæ ¼å¼åŒ–ä¸º "XXms" æˆ– "X.Xs"ï¼‰
- âœ… TypeScript ç±»å‹å®šä¹‰æ‰©å±•ï¼ˆToolCall å’Œ PartMetadataï¼‰
- âœ… è®¡æ—¶å™¨ä½ç½®ä¼˜åŒ–ï¼ˆé¿å…ä¸å…¶ä»– UI å…ƒç´ é‡å ï¼‰
- âœ… å®Œå…¨éš”ç¦»ï¼Œä¸å½±å“ Azure Assistants ç­‰å…¶ä»–æ¨¡å—

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `api/server/services/Agents/e2bAgent/index.js`: æ·»åŠ è®¡æ—¶é€»è¾‘
- `packages/data-provider/src/types/agents.ts`: æ‰©å±• ToolCall ç±»å‹
- `packages/data-provider/src/types/assistants.ts`: æ‰©å±• PartMetadata ç±»å‹
- `client/src/components/Chat/Messages/Content/Parts/ExecuteCode.tsx`: æ·»åŠ è®¡æ—¶å™¨ UI
- `client/src/components/Chat/Messages/Content/Part.tsx`: ä¼ é€’è®¡æ—¶æ•°æ®

**æŠ€æœ¯ç»†èŠ‚**:
- è®¡æ—¶ç²¾åº¦ï¼šæ¯«ç§’çº§ï¼ˆDate.now()ï¼‰
- å®æ—¶æ›´æ–°ï¼šæ‰§è¡Œä¸­æ¯ 100ms åˆ·æ–°ä¸€æ¬¡
- æ ¼å¼åŒ–ï¼š< 1s æ˜¾ç¤º "XXms"ï¼Œâ‰¥ 1s æ˜¾ç¤º "X.Xs"
- ä½ç½®ï¼šæ˜¾ç¤ºåœ¨ä»£ç å—å’Œè¾“å‡ºä¸‹æ–¹ï¼Œç‹¬ç«‹è¡Œ

ä¸ºäº†ä¿æŒæœ¬æ–‡æ¡£çš„ç®€æ´æ€§ï¼Œè¯¦ç»†çš„æ¶æ„ä¼˜åŒ–è®°å½•ã€Bug ä¿®å¤è¯¦æƒ…å’Œå†å²å˜æ›´å·²ç§»åŠ¨åˆ°ä»¥ä¸‹ä¸“é—¨æ–‡æ¡£ï¼š

- **é—®é¢˜è§£å†³ä¸ä¿®å¤è¯¦æƒ…**: è¯·å‚é˜… [E2B_AGENT_FIXES.md](./E2B_AGENT_FIXES.md)
  - åŒ…å« 2026-01-14 çš„å…³é”®é”™è¯¯æ£€æµ‹é€»è¾‘ä¿®å¤
  - åŒ…å« 2026-01-07 çš„æ¶æ„ä¼˜åŒ–ï¼ˆå›¾ç‰‡è·¯å¾„ã€æ— é™é‡è¯•ã€å·¥å…·ç²¾ç®€ç­‰ï¼‰
  - åŒ…å«å›¾è¡¨æ˜¾ç¤ºå’Œ SSE æµå¼ä¼ è¾“çš„ä¿®å¤ç»†èŠ‚

- **æ¯æ—¥å·¥ä½œæ—¥å¿—**: è¯·å‚é˜… [WORK_LOG.md](./WORK_LOG.md)
  - åŒ…å«æ¯æ—¥è¯¦ç»†çš„å¼€å‘è¿›åº¦å’Œå†³ç­–è®°å½•

- **å¾…åŠäº‹é¡¹ä¸è§„åˆ’**: è¯·å‚é˜… [TODO.md](./TODO.md)

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-23  
**æœ€åæ›´æ–°**: 2026-01-15  
**å½“å‰çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Azure OpenAI é›†æˆå®Œæˆï¼ŒSystem Prompt ä¼˜åŒ–å®Œæˆã€‚åŠ©æ‰‹é…ç½®ã€å†å²å¯¹è¯ã€å›¾åƒæ˜¾ç¤ºã€æ²™ç®±å¤ç”¨ã€å®æ—¶æµå¼å“åº”ã€é”™è¯¯è‡ªæ„ˆã€Azure é£æ ¼è¾“å‡ºå‡å·²æ­£å¸¸å·¥ä½œã€‚
**å½“å‰åˆ†æ”¯**: `feature/e2b-integration`