# Do not edit this file directly. Use a ‘docker-compose.override.yaml’ file if you can.
# Refer to `docker-compose.override.yaml.example’ for some sample configurations.

services:
  api:
    container_name: LibreChat
    ports:
      - "${PORT}:${PORT}"
    image: ghcr.io/danny-avila/librechat-dev:latest
    restart: always
    user: "${UID}:${GID}"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - HOST=0.0.0.0
      - MONGO_URI=mongodb://atlas:27017/LibreChat
      - NODE_EXTRA_CA_CERTS=/etc/ssl/certs/ca-certificates.crt
    volumes:
      - type: bind
        source: ./librechat.yaml
        target: /app/librechat.yaml
      - type: bind
        source: ./paychex-root.pem
        target: /app/paychex-root.pem
      - /etc/ssl/certs:/etc/ssl/certs
    depends_on:
      - atlas
  rag_api:
    container_name: rag_api
    image: ghcr.io/danny-avila/librechat-rag-api-dev:latest
    environment:
      - DB_HOST=atlas
    restart: always
    depends_on:
      - atlas
    volumes:
      - type: bind
        source: ./paychex-root.pem
        target: /app/paychex-root.pem
      - /etc/ssl/certs:/etc/ssl/certs 
  mongodb:
    image: rjocoleman/noop:latest
    environment:
      - NOOP_INFINITY=true
    command: "sleep infinity"
  vectordb:
    image: rjocoleman/noop:latest
    command: "sleep infinity"
    environment:
      - NOOP_INFINITY=true
    volumes: [] #Clearing volumes since its we are not using PostGres
  atlas:
    hostname: atlas
    restart: unless-stopped
    image: mongodb/mongodb-atlas-local
    user: "1000:1000"
    ports:
      - 27017:27017
    volumes:
      - ./data:/data/db
      - ./config-db:/data/configdb
#volumes:
#  data:
#  config-db:
