# E2B Data Analyst Agent å¼€å‘æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ç›®æ ‡
åœ¨LibreChaté¡¹ç›®ä¸­å¼€å‘åŸºäºE2Bæ²™ç®±çš„æ•°æ®åˆ†æAgentæ¨¡å—ï¼Œä¸Azure Assistants**å¹¶è¡Œ**è¿è¡Œï¼Œç”¨äºå¤„ç†Azure Assistantsæ— æ³•è§£å†³çš„åœºæ™¯ï¼ˆå¦‚é•¿æ—¶é—´è¿è¡Œçš„ä»£ç æ‰§è¡Œã€XGBoostç­‰å¯†é›†å‹å·¥ä½œè´Ÿè½½ï¼‰ã€‚

### 1.2 æ¶æ„å®šä½
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LibreChat Frontend                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Layer (Express.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Azure Assistants â”‚  â”‚  E2B Assistants  â”‚              â”‚
â”‚  â”‚  (ç°æœ‰)          â”‚  â”‚  (æ–°å¢)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                        â”‚                       â”‚
â”‚         â–¼                        â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Azure OpenAI API â”‚  â”‚  E2B + LLM API   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦è¯´æ˜**ï¼š
- **ä¸åˆ é™¤**ç°æœ‰çš„Azure Assistantsæ¨¡å—
- ä¸¤è€…å¹¶è¡Œè¿è¡Œï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©
- E2B Agentä¸“é—¨ç”¨äºéœ€è¦é•¿æ—¶é—´ä»£ç æ‰§è¡Œã€å¤æ‚è®¡ç®—çš„åœºæ™¯
- è®¿é—®æ§åˆ¶ï¼ˆç§æœ‰/å…¬å…±Assistantï¼‰ç”±åä½œäººå‘˜å®ç°

---

## 2. èŒè´£åˆ†å·¥

| æ¨¡å— | è´Ÿè´£äºº | è¯´æ˜ |
|------|--------|------|
| E2Bå®¢æˆ·ç«¯é›†æˆ | **å½“å‰å¼€å‘** | E2B SDKé›†æˆã€æ²™ç®±ç®¡ç† |
| Code ExecutionæœåŠ¡ | **å½“å‰å¼€å‘** | ä»£ç æ‰§è¡Œã€ç»“æœæ•è· |
| Data Analyst Agent | **å½“å‰å¼€å‘** | Agentæ ¸å¿ƒé€»è¾‘ã€LLMé›†æˆ |
| æ–‡ä»¶å¤„ç† | **å½“å‰å¼€å‘** | æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®é›†åŠ è½½ |
| è®¿é—®æ§åˆ¶ | **åä½œäººå‘˜** | ç§æœ‰/å…¬å…±Assistantæƒé™ç®¡ç† |
| å‰ç«¯UI | **åä½œäººå‘˜** | E2B Assistantç•Œé¢å±•ç¤º |
| é…ç½®ç®¡ç† | **åä½œäººå‘˜** | ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ |

---

## 3. æŠ€æœ¯æ ˆ

### 3.1 æ ¸å¿ƒä¾èµ–
- **E2B Code Interpreter SDK**: `@e2b/code-interpreter` (v2.8.4+)
- **OpenAI API**: `openai` (ç”¨äºLLM)
- **MongoDB**: å­˜å‚¨Assistanté…ç½®
- **Node.js/Express.js**: åç«¯æ¡†æ¶

---

## 4. ç›®å½•ç»“æ„è§„åˆ’

```
LibreChat/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ E2BAssistant.js              # [å·²å®ç°] E2B Assistantæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ Agents/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ e2bAgent/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ index.js        # [å·²å®ç°] Data Analyst Agentæ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ prompts.js     # [å·²å®ç°] ç³»ç»Ÿæç¤ºè¯
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ tools.js       # [å·²å®ç°] å·¥å…·å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Endpoints/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ e2bAssistants/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ index.js       # [å·²å®ç°] ç«¯ç‚¹å…¥å£
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ initialize.js  # [å·²å®ç°] E2Bå®¢æˆ·ç«¯ç®¡ç†å™¨ (E2BClientManager)
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ buildOptions.js # [å·²å®ç°] é€‰é¡¹æ„å»º
â”‚   â”‚   â”‚   â”œâ”€â”€ Sandbox/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ codeExecutor.js    # [å·²å®ç°] ä»£ç æ‰§è¡ŒæœåŠ¡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ fileHandler.js     # [å·²å®ç°] æ–‡ä»¶å¤„ç†æœåŠ¡ (æ”¯æŒLocal/S3/Azure)
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â””â”€â”€ e2bAssistants/
â”‚   â”‚           â”œâ”€â”€ index.js           # [å·²å®ç°] è·¯ç”±æ³¨å†Œ
â”‚   â”‚           â””â”€â”€ controller.js      # [å·²å®ç°] æ§åˆ¶å™¨é€»è¾‘
â”‚   â””â”€â”€ tests/
â”‚       â””â”€â”€ e2b/
â”‚           â”œâ”€â”€ codeExecutor.test.js   # [å·²å®ç°] CodeExecutorå•å…ƒæµ‹è¯•
â”‚           â”œâ”€â”€ fileHandler.test.js    # [å·²å®ç°] FileHandlerå•å…ƒæµ‹è¯•
â”‚           â”œâ”€â”€ real_integration.js    # [å·²å®ç°] çœŸå®ç¯å¢ƒç«¯åˆ°ç«¯æµ‹è¯•
â”‚           â””â”€â”€ debug_sandbox.js       # [å·²å®ç°] æ²™ç®±è°ƒè¯•è„šæœ¬
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ data-schemas/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ schema/
â”‚       â”‚   â”‚   â””â”€â”€ e2bAssistant.ts    # [å·²å®ç°] E2B Assistant Schema
â”‚       â”‚   â”œâ”€â”€ models/
â”‚       â”‚   â”‚   â””â”€â”€ e2bAssistant.ts    # [å·²å®ç°] E2B Assistant Model
â”‚       â”‚   â””â”€â”€ types/
â”‚       â”‚       â””â”€â”€ e2bAssistant.ts    # [å·²å®ç°] TypeScriptç±»å‹å®šä¹‰
```

---

## 5. æ ¸å¿ƒæ¨¡å—å®ç°è¯¦æƒ…

### 5.1 E2BClientManager (`initialize.js`)
- **åŠŸèƒ½**: ç®¡ç† E2B æ²™ç®±ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºã€é”€æ¯ã€é‡ç”¨ï¼‰ã€‚
- **SDKé€‚é…**: é€‚é…äº† `@e2b/code-interpreter` v2.8.4ï¼Œä½¿ç”¨ `Sandbox.create()` å’Œ `sandbox.kill()`ã€‚
- **æ–‡ä»¶æ“ä½œ**: ä½¿ç”¨ `.files` API è¿›è¡Œæ–‡ä»¶è¯»å†™ã€‚
- **é…ç½®**: é»˜è®¤ `secure: false` ä»¥å¢å¼ºå…¼å®¹æ€§ï¼Œå¹¶æ”¯æŒæ™ºèƒ½æ¨¡æ¿é€‰æ‹©ã€‚

### 5.2 CodeExecutor (`codeExecutor.js`)
- **åŠŸèƒ½**: åœ¨æ²™ç®±ä¸­æ‰§è¡Œ Python ä»£ç ï¼Œå¤„ç† `stdout`/`stderr`ï¼Œå¹¶æå–ç”Ÿæˆçš„å›¾è¡¨ã€‚
- **ç‰¹æ€§**: 
  - **å›¾è¡¨æå–**: è‡ªåŠ¨ä» execution results ä¸­æå– PNG/JPEG/SVG æ ¼å¼çš„å›¾ç‰‡ï¼Œå¹¶è½¬æ¢ä¸º Base64ã€‚
  - **å®‰å…¨æ ¡éªŒ**: åŒ…å«åŸºç¡€çš„ä»£ç å®‰å…¨æ£€æŸ¥ï¼Œæ‹¦æˆªå±é™©å‡½æ•°ï¼ˆå¦‚ `os.system`ï¼‰ã€‚
  - **æ‰¹é‡æ‰§è¡Œ**: æ”¯æŒæŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªä»£ç å—ã€‚

### 5.3 FileHandler (`fileHandler.js`)
- **åŠŸèƒ½**: å¤„ç† LibreChat ç³»ç»Ÿå­˜å‚¨ä¸ E2B æ²™ç®±ä¹‹é—´çš„æ–‡ä»¶åŒæ­¥ã€‚
- **ç‰¹æ€§**:
  - **å¤šå­˜å‚¨æ”¯æŒ**: å…¼å®¹ Local, S3, Azure Blob Storageã€‚
  - **Artifacts æŒä¹…åŒ–**: å°†æ²™ç®±ç”Ÿæˆçš„åˆ†æç»“æœï¼ˆå›¾ç‰‡ã€CSVç­‰ï¼‰ä¸‹è½½å¹¶ä¿å­˜åˆ° LibreChat ç³»ç»Ÿå­˜å‚¨ï¼Œåˆ›å»ºå¯¹åº”çš„æ•°æ®åº“è®°å½•ã€‚
  - **å†…å­˜æŒä¹…åŒ–**: æ”¯æŒç›´æ¥å°†å†…å­˜ä¸­çš„ Buffer (å¦‚ç”Ÿæˆçš„å›¾è¡¨) ä¿å­˜åˆ°å­˜å‚¨ç³»ç»Ÿï¼Œæ— éœ€é‡å¤ä¸‹è½½ã€‚

### 5.4 E2BDataAnalystAgent (`index.js`)
- **åŠŸèƒ½**: åŸºäº ReAct å¾ªç¯çš„æ™ºèƒ½ä»£ç†ã€‚
- **ç‰¹æ€§**:
  - **è‡ªæ„ˆèƒ½åŠ›**: å½“ä»£ç æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå°†é”™è¯¯åé¦ˆç»™ LLM å¹¶è‡ªåŠ¨é‡è¯•ã€‚
  - **å·¥å…·è°ƒç”¨**: é›†æˆ `execute_code`, `upload_file`, `download_file` å·¥å…·ã€‚
  - **å¤šè½®å¯¹è¯**: ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡å’Œæ²™ç®±çŠ¶æ€ã€‚

---

## 6. ç³»ç»Ÿé›†æˆç‚¹

### 6.1 ç«¯ç‚¹æ³¨å†Œ
- **Enum**: åœ¨ `packages/data-provider/src/schemas.ts` æ·»åŠ äº† `EModelEndpoint.e2bAssistants`ã€‚
- **Index**: åœ¨ `api/server/services/Endpoints/index.js` æ³¨å†Œäº†åˆå§‹åŒ–å…¥å£ã€‚
- **Config**: åœ¨ `api/server/services/Config/EndpointService.js` æ·»åŠ äº†é…ç½®ç”Ÿæˆé€»è¾‘ã€‚

### 6.2 åŠ©æ‰‹é€»è¾‘é›†æˆ
- **Helpers**: åœ¨ `api/server/controllers/assistants/helpers.js` ä¸­æ·»åŠ äº†å¯¹ `e2bAssistants` çš„æ”¯æŒï¼š
  - `getOpenAIClient`: è·¯ç”±åˆ° E2B çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¹¶ç¡®ä¿åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯è¿›è¡Œ Agent æ¨ç†ã€‚
  - `fetchAssistants`: ä» `E2BAssistant` æ¨¡å‹è·å–åŠ©æ‰‹åˆ—è¡¨ã€‚

---

## 7. è‡ªå®šä¹‰æ¨¡æ¿ä¸é¢„è£…åŒ… (é‡è¦ ğŸ’¡)

### 7.1 æ¨¡æ¿ç³»ç»Ÿ (V2)
æœ¬é¡¹ç›®é‡‡ç”¨ E2B æœ€æ–°çš„ **TypeScript æ¨¡æ¿ç³»ç»Ÿ**ã€‚æ¨¡æ¿å®šä¹‰ä½äº `e2b_template/data-analyst/template.ts`ã€‚è¿™ç§æ–¹å¼æ¯”æ—§çš„ Dockerfile æ›´çµæ´»ï¼Œæ”¯æŒç¼–ç¨‹å¼å®šä¹‰ç¯å¢ƒã€‚

### 7.2 æ„å»ºä¸å‘å¸ƒæ­¥éª¤
å¦‚æœéœ€è¦æ·»åŠ æ–°çš„ Python åŒ…ï¼ˆå¦‚ `lightgbm`ï¼‰æˆ–ç³»ç»Ÿä¾èµ–ï¼š

1.  **ä¿®æ”¹æ¨¡æ¿å®šä¹‰**:
    ç¼–è¾‘ `e2b_template/data-analyst/template.ts`:
    ```typescript
    // ç¤ºä¾‹ï¼šæ·»åŠ æ–°çš„ Python åŒ…
    .run("pip install lightgbm")
    ```

2.  **æ„å»ºæ¨¡æ¿**:
    ```bash
    cd e2b_template/data-analyst
    npm install
    # æ„å»ºå¼€å‘ç‰ˆ (Dev)
    npm run e2b:build:dev
    # æˆ–æ„å»ºç”Ÿäº§ç‰ˆ (Prod)
    # npm run e2b:build:prod
    ```

3.  **è·å– Template ID**:
    æ„å»ºæˆåŠŸåï¼Œæ§åˆ¶å°ä¼šè¾“å‡º Template ID (å¦‚ `xed696qfsyzpaei3ulh5`)ã€‚

4.  **é…ç½®ä½¿ç”¨**:
    å°†æ–°çš„ Template ID æ›´æ–°åˆ° `.env` æ–‡ä»¶ä¸­ï¼š
    ```bash
    E2B_SANDBOX_TEMPLATE=xed696qfsyzpaei3ulh5
    ```

---

## 8. æ•…éšœæ’é™¤ (Troubleshooting)

### 8.1 502: The sandbox is running but port is not open
*   **åŸå› **ï¼šæ²™ç®±å†…çš„ä»£ç è§£é‡Šå™¨è¿›ç¨‹æœªå¯åŠ¨ã€‚
*   **è§£å†³æ–¹æ³•**ï¼š
    1.  **æ£€æŸ¥ Template ID**ï¼šç¡®ä¿ `.env` ä¸­çš„ ID å¯¹åº”çš„æ˜¯åŸºäº `code-interpreter` æ„å»ºçš„æ¨¡æ¿ã€‚
    2.  **é‡æ–°æ„å»º**ï¼šå¦‚æœæ¨¡æ¿æŸåï¼Œé‡æ–°è¿è¡Œæ„å»ºå‘½ä»¤ç”Ÿæˆæ–° IDã€‚

### 8.2 400: Template is not compatible with secured access
*   **åŸå› **ï¼šE2B API Key å¼€å¯äº†â€œå®‰å…¨è®¿é—®â€é™åˆ¶ã€‚
*   **è§£å†³æ–¹æ³•**ï¼šæˆ‘ä»¬åœ¨ä»£ç ä¸­å·²é»˜è®¤è®¾ç½® `secure: false`ã€‚å¦‚æœé—®é¢˜ä¾æ—§ï¼Œè¯·æ£€æŸ¥ E2B Dashboard çš„ API Key è®¾ç½®ã€‚

---

## 9. å‰ç«¯é›†æˆçŠ¶æ€ä¸å·²çŸ¥é—®é¢˜ (2026-01-04)

### 9.1 å·²å®Œæˆçš„é›†æˆ âœ…
- **å›¾æ ‡æ”¯æŒ**: E2B Assistants ç°åœ¨ä½¿ç”¨ Sparkles (âœ¨) å›¾æ ‡ã€‚
- **åŠ©æ‰‹åˆ›å»º**: ä¿®å¤äº† JSON è§£æé”™è¯¯ï¼ŒåŠ©æ‰‹å¯ä»¥æˆåŠŸåˆ›å»ºå¹¶ä¿å­˜åˆ°æ•°æ®åº“ã€‚
- **åç«¯è·¯ç”±**: è¡¥å…¨äº† `/documents` å’Œ `/tools` ç«¯ç‚¹ï¼Œæ¶ˆé™¤äº†å‰ç«¯ 404 é”™è¯¯ã€‚
- **åŠ©æ‰‹åˆ—è¡¨**: ä¿®å¤ API å“åº”æ ¼å¼ï¼Œåˆ·æ–°åå¯æ­£ç¡®æ˜¾ç¤ºå·²åˆ›å»ºçš„åŠ©æ‰‹ã€‚
- **æ–‡ä»¶ä¸Šä¼ **: å®Œæ•´å®ç°æ–‡ä»¶ä¸Šä¼ åˆ° E2B æ²™ç®±åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆLocal/S3/Azureï¼‰ã€‚
- **æ¶ˆæ¯æµ**: SSE æ¶ˆæ¯æ ¼å¼å®Œå…¨å¯¹é½å‰ç«¯é¢„æœŸï¼Œå®ç° created å’Œ final äº‹ä»¶ã€‚
- **æ•°æ®æŒä¹…åŒ–**: ç”¨æˆ·æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“ã€‚

### 9.2 ä¿®å¤çš„å…³é”® Bug âœ…

#### âœ… 1. æ–‡ä»¶ä¸Šä¼ å¤±è´¥ (å·²ä¿®å¤)
- **é—®é¢˜**: `Cannot read properties of undefined (reading 'paths')`
- **åŸå› **: E2B è·¯ç”±ç¼ºå°‘ `configMiddleware`ï¼Œå¯¼è‡´ `req.config` æœªåˆå§‹åŒ–
- **ä¿®å¤**: åœ¨è·¯ç”±ä¸­æ·»åŠ  `configMiddleware`ï¼Œç¡®ä¿é…ç½®æ­£ç¡®åŠ è½½

#### âœ… 2. å‰ç«¯æ— è¾“å‡º (å·²ä¿®å¤)
- **é—®é¢˜**: æ¶ˆæ¯å‘é€åå‰ç«¯æ— å“åº”ï¼Œæ˜¾ç¤º "2/2" ä½†æ— å†…å®¹
- **åŸå› **: SSE æ¶ˆæ¯æ ¼å¼ä¸ç¬¦åˆå‰ç«¯é¢„æœŸï¼Œç¼ºå°‘å¿…éœ€å­—æ®µ
- **ä¿®å¤**: 
  - å®ç°å®Œæ•´çš„ SSE äº‹ä»¶æµï¼ˆcreated â†’ finalï¼‰
  - æ·»åŠ  conversation, requestMessage, responseMessage
  - ä½¿ç”¨ `sanitizeMessageForTransmit` æ¸…ç†æ¶ˆæ¯

#### âœ… 3. åŠ©æ‰‹åˆ—è¡¨ä¸æ˜¾ç¤º (å·²ä¿®å¤)
- **é—®é¢˜**: åˆ·æ–°é¡µé¢åçœ‹ä¸åˆ°å·²åˆ›å»ºçš„åŠ©æ‰‹
- **åŸå› **: API è¿”å›æ•°ç»„è€Œé `{ data: [...] }` æ ¼å¼
- **ä¿®å¤**: ç»Ÿä¸€ API å“åº”æ ¼å¼ï¼Œä¸ Azure Assistants ä¿æŒä¸€è‡´

#### âœ… 4. åŠ©æ‰‹é…ç½®ä¿å­˜é—®é¢˜ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: åˆ›å»ºåŠ©æ‰‹ååˆ·æ–°é¡µé¢ï¼Œéƒ¨åˆ†é…ç½®å­—æ®µé‡ç½®ï¼ˆdescriptionã€instructionsã€conversation_startersã€append_current_datetimeã€toolsç­‰ï¼‰
- **åŸå› **: 
  - Schemaç¼ºå°‘ `append_current_datetime`ã€`tools`ã€`tool_resources` å­—æ®µå®šä¹‰
  - Controllerçš„ get/list/update æ–¹æ³•æœªæ˜ å°„æ‰€æœ‰å­—æ®µ
  - `instructions` â†” `prompt` å­—æ®µæ˜ å°„ä¸å®Œæ•´
- **ä¿®å¤**:
  - åœ¨ `e2bAssistantSchema` ä¸­æ·»åŠ ç¼ºå¤±å­—æ®µï¼ˆappend_current_datetimeã€toolsã€tool_resourcesï¼‰
  - åœ¨ `createAssistant` ä¸­ä¿å­˜æ‰€æœ‰å‰ç«¯å‘é€çš„å­—æ®µ
  - åœ¨ `getAssistant`/`listAssistants` ä¸­è¿”å›å®Œæ•´å­—æ®µæ˜ å°„å¹¶è®¾ç½®é»˜è®¤å€¼
  - åœ¨ `updateAssistant` ä¸­ä½¿ç”¨ç™½åå•æ–¹å¼å¤„ç†æ‰€æœ‰å¯æ›´æ–°å­—æ®µ

#### âœ… 5. å¯¹è¯å†å²ä¸¢å¤±é—®é¢˜ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: åŒä¸€å¯¹è¯ä¸­çš„ç¬¬äºŒæ¡æ¶ˆæ¯ä¸è®°å¾—ç¬¬ä¸€æ¡è¯´äº†ä»€ä¹ˆ
- **åŸå› **: `chat` ç«¯ç‚¹è°ƒç”¨ `agent.processMessage(text)` æ—¶æœªä¼ é€’å†å²æ¶ˆæ¯
- **ä¿®å¤**:
  - åœ¨ `controller.js` ä¸­æ·»åŠ  `getMessages` å¯¼å…¥
  - åœ¨è°ƒç”¨ `processMessage` å‰ä½¿ç”¨ `getMessages` åŠ è½½å¯¹è¯å†å²
  - å°†å†å²æ¶ˆæ¯è½¬æ¢ä¸º OpenAI æ ¼å¼ï¼ˆrole: user/assistantï¼‰å¹¶ä¼ é€’ç»™ Agent

#### âœ… 6. å›¾åƒè·¯å¾„æ›¿æ¢å¤±è´¥ (å·²ä¿®å¤ - 2026-01-04)
- **é—®é¢˜**: LLMç”Ÿæˆçš„sandbox:è·¯å¾„æ— æ³•åœ¨å‰ç«¯æ˜¾ç¤ºå›¾åƒ
- **åŸå› **: 
  - `image_url_map` ä¸­çš„è·¯å¾„æ¨¡å¼ä¸å¤Ÿå…¨é¢
  - ä»…ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼Œæ— æ³•å¤„ç†LLMç”Ÿæˆçš„å„ç§è·¯å¾„æ ¼å¼
- **ä¿®å¤**:
  - åœ¨ `tools.js` ä¸­æ·»åŠ æ›´å¤šsandboxè·¯å¾„æ¨¡å¼ï¼ˆsandbox:/ã€sandbox://ã€/tmp/ç­‰ï¼‰
  - åœ¨ `index.js` ä¸­æ·»åŠ ä¸¤å±‚æ›¿æ¢ç­–ç•¥ï¼š
    1. ç²¾ç¡®åŒ¹é… `image_url_map` ä¸­çš„æ‰€æœ‰æ¨¡å¼
    2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä»»ä½•åŒ…å«å›¾åƒæ–‡ä»¶åçš„sandbox:æˆ–æ–‡ä»¶è·¯å¾„
  - å­˜å‚¨ `image_names` å’Œ `image_actual_paths` ç”¨äºæ¨¡å¼åŒ¹é…

### 9.3 å½“å‰åŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åŠ©æ‰‹åˆ›å»º | âœ… å®Œæˆ | æ”¯æŒé€šè¿‡ Builder åˆ›å»ºåŠ©æ‰‹ |
| åŠ©æ‰‹é…ç½®ä¿å­˜ | âœ… å®Œæˆ | æ‰€æœ‰é…ç½®å­—æ®µæ­£ç¡®æŒä¹…åŒ– |
| åŠ©æ‰‹åˆ—è¡¨ | âœ… å®Œæˆ | åˆ·æ–°åæ­£ç¡®æ˜¾ç¤º |
| æ–‡ä»¶ä¸Šä¼  | âœ… å®Œæˆ | æ”¯æŒ Local/S3/Azure å­˜å‚¨ |
| ä»£ç æ‰§è¡Œ | âœ… å®Œæˆ | E2B æ²™ç®±æ‰§è¡Œ Python ä»£ç  |
| å›¾åƒç”Ÿæˆ | âœ… å®Œæˆ | è‡ªåŠ¨æå–å¹¶æ˜¾ç¤ºmatplotlib/seabornå›¾è¡¨ |
| æ¶ˆæ¯æ˜¾ç¤º | âœ… å®Œæˆ | SSE æµå¼è¿”å›æ¶ˆæ¯ |
| æ•°æ®æŒä¹…åŒ– | âœ… å®Œæˆ | æ¶ˆæ¯ä¿å­˜åˆ° MongoDB |
| å†å²å¯¹è¯ | âœ… å®Œæˆ | å¤šè½®å¯¹è¯ä¿æŒä¸Šä¸‹æ–‡ |
| æ²™ç®±å¤ç”¨ | âœ… å®Œæˆ | åŒä¸€å¯¹è¯å¤ç”¨æ²™ç®±å®ä¾‹ |

### 9.4 å¾…ä¼˜åŒ–åŠŸèƒ½

- **æµå¼å“åº”**: å½“å‰ä¸ºæ‰¹é‡è¿”å›ï¼Œå¯ä¼˜åŒ–ä¸ºé€ token æµå¼è¾“å‡º
- **é”™è¯¯é‡è¯•**: å¢å¼º LLM å·¥å…·è°ƒç”¨å¤±è´¥çš„é‡è¯•æœºåˆ¶
- **Token ä¼˜åŒ–**: å‡å°‘ç³»ç»Ÿæç¤ºè¯å’Œå·¥å…·å®šä¹‰çš„ Token æ¶ˆè€—
- **è®¿é—®æ§åˆ¶**: å®ç°ç§æœ‰/å…¬å…±åŠ©æ‰‹æƒé™ç®¡ç†ï¼ˆå¾…åä½œäººå‘˜å®Œæˆï¼‰

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-23  
**æœ€åæ›´æ–°**: 2026-01-04  
**å½“å‰çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å®Œæˆï¼åŠ©æ‰‹é…ç½®ã€å†å²å¯¹è¯ã€å›¾åƒæ˜¾ç¤ºã€æ²™ç®±å¤ç”¨å‡å·²æ­£å¸¸å·¥ä½œã€‚
**å½“å‰åˆ†æ”¯**: `feature/e2b-integration`
